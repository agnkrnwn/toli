<!DOCTYPE html>
<html lang="id" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hadist Quote Generator</title>
    <link rel="icon" href="../../asset/icon/favicon.ico" type="image/x-icon">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            100: '#334155',
                            200: '#1e293b',
                            300: '#0f172a',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .dot {
    transition: transform 0.3s ease-in-out;
}

input:checked ~ .dot {
    transform: translateX(100%);
}

input:checked + .block {
    background-color: #4299e1;
}
    </style>
</head>
<body class="bg-gray-100 dark:bg-dark-300 text-gray-900 dark:text-gray-100 font-sans">
    <div id="app" class="max-w-md mx-auto p-6 bg-white dark:bg-dark-200 shadow-lg rounded-lg my-8">
        <h1 class="text-3xl font-bold text-center mb-6 text-blue-600 dark:text-blue-400">Hadist Quote Generator</h1>
        
        <div class="space-y-4">
            <div class="flex items-center space-x-2">
                <select id="hadistSelect" class="flex-1 p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-dark-100 dark:text-gray-100 dark:border-gray-600">
                    <option value="">Pilih Kitab Hadist</option>
                    <option value="abu-dawud">Abu Dawud</option>
                    <option value="ahmad">Ahmad</option>
                    <option value="bukhari">Bukhari</option>
                    <option value="ibnu-majah">Ibnu Majah</option>
                    <option value="malik">Malik</option>
                    <option value="nasai">Nasai</option>
                    <option value="tirmidzi">Tirmidzi</option>
                </select>
                <input type="number" id="hadistNumber" placeholder="Nomor Hadist" class="flex-1 p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-dark-100 dark:text-gray-100 dark:border-gray-600">
            </div>
    
            <div class="flex items-center space-x-2">
                <div class="flex-1">
                    <label for="bgColorPicker" class="block text-sm font-medium mb-1">Warna Latar</label>
                    <input type="color" id="bgColorPicker" value="#1e293b" class="w-full h-10 rounded-md cursor-pointer">
                </div>
                <div class="flex-1">
                    <label for="textColorPicker" class="block text-sm font-medium mb-1">Warna Teks</label>
                    <input type="color" id="textColorPicker" value="#ffffff" class="w-full h-10 rounded-md cursor-pointer">
                </div>
            </div>

            <!-- <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                    <button id="generateBtn" class="p-2 w-100 bg-blue-600 hover:bg-blue-700 text-white rounded-md transition duration-300 ease-in-out">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                    </button>
                    <button id="randomBtn" class="p-2 w-100 bg-purple-600 hover:bg-purple-700 text-white rounded-md transition duration-300 ease-in-out">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" />
                        </svg>
                    </button>
                </div>
                <div class="flex items-center space-x-2">
                    <label for="showArabic" class="flex items-center cursor-pointer">
                        <div class="relative">
                            <input type="checkbox" id="showArabic" class="sr-only">
                            <div class="block bg-gray-600 w-10 h-6 rounded-full"></div>
                            <div class="dot absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition"></div>
                        </div>
                        <div class="ml-3 text-sm font-medium">
                            Ø¹
                        </div>
                    </label>
                </div>
            </div> -->

            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                    <button id="generateBtn" class="p-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md transition duration-300 ease-in-out">
                        <i class="fas fa-sync-alt mr-3"></i>
                        Generate</button>
                    <button id="randomBtn" class="p-2 bg-purple-600 hover:bg-purple-700 text-white rounded-md transition duration-300 ease-in-out">
                        <i class="fas fa-random mr-3"></i>
                        Random</button>
                </div>
                <div class="flex items-center space-x-2">
                    <label for="showArabic" class="flex items-center cursor-pointer">
                        <div class="relative">
                            <input type="checkbox" id="showArabic" class="sr-only">
                            <div class="block bg-gray-600 w-10 h-6 rounded-full"></div>
                            <div class="dot absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition"></div>
                        </div>
                        <div class="ml-3 text-sm font-medium">
                            <i class="fas fa-cog"></i>
                        </div>
                    </label>
                </div>
            </div>


    
            <canvas id="quoteCanvas" class="w-full rounded-md shadow-lg"></canvas>
    
            <button id="downloadBtn" class="w-full p-2 bg-green-600 hover:bg-green-700 text-white rounded-md transition duration-300 ease-in-out" disabled>Download Quote</button>
        </div>
    </div>

    <script>
        const hadistSelect = document.getElementById('hadistSelect');
        const hadistNumber = document.getElementById('hadistNumber');
        const showArabic = document.getElementById('showArabic');
        const generateBtn = document.getElementById('generateBtn');
        const randomBtn = document.getElementById('randomBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        const canvas = document.getElementById('quoteCanvas');
        const ctx = canvas.getContext('2d');
        const bgColorPicker = document.getElementById('bgColorPicker');
        const textColorPicker = document.getElementById('textColorPicker');

        // Set canvas size for TikTok (9:16 aspect ratio)
        canvas.width = 1080;
        canvas.height = 1920;

        let currentHadists = [];
        let currentAuthor = '';
        let currentIndex = 0;

        generateBtn.addEventListener('click', generateQuote);
        randomBtn.addEventListener('click', generateRandomQuote);
        downloadBtn.addEventListener('click', downloadQuote);
        bgColorPicker.addEventListener('change', redrawQuote);
        textColorPicker.addEventListener('change', redrawQuote);

        // Generate random quote on page load
        window.addEventListener('load', generateRandomQuote);

        async function loadHadists(selected) {
            try {
                const response = await fetch(`./asset/data/hadist/${selected}.json`);
                currentHadists = await response.json();
                return currentHadists;
            } catch (error) {
                console.error('Error loading hadist:', error);
                alert('Error loading hadist. Please try again.');
                return [];
            }
        }

        async function generateQuote() {
            const selected = hadistSelect.value;
            const number = hadistNumber.value;

            if (!selected) {
                alert('Pilih kitab hadist.');
                return;
            }

            currentAuthor = hadistSelect.options[hadistSelect.selectedIndex].text;
            const hadists = await loadHadists(selected);

            let hadist;
            if (number) {
                hadist = hadists.find(h => h.number === parseInt(number));
                currentIndex = hadists.indexOf(hadist);
            } else {
                currentIndex = Math.floor(Math.random() * hadists.length);
                hadist = hadists[currentIndex];
            }

            if (!hadist) {
                alert('Hadist tidak ditemukan.');
                return;
            }

            drawQuote(hadist);
            downloadBtn.disabled = false;
        }

        async function generateRandomQuote() {
            const selected = hadistSelect.value || hadistSelect.options[Math.floor(Math.random() * (hadistSelect.options.length - 1)) + 1].value;
            hadistSelect.value = selected;
            currentAuthor = hadistSelect.options[hadistSelect.selectedIndex].text;

            const hadists = await loadHadists(selected);
            currentIndex = Math.floor(Math.random() * hadists.length);
            const hadist = hadists[currentIndex];

            drawQuote(hadist);
            downloadBtn.disabled = false;
        }

        function drawQuote(hadist) {
            ctx.fillStyle = bgColorPicker.value;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            const maxWidth = canvas.width - 200;
            
            let totalHeight = 0;
            if (showArabic.checked) {
                ctx.font = 'bold 40px Arial';
                totalHeight += measureTextHeight(ctx, hadist.arab, maxWidth, 60);
                totalHeight += 80;
            }
            ctx.font = '36px Arial';
            totalHeight += measureTextHeight(ctx, hadist.id, maxWidth, 50);
            totalHeight += 400;

            let y = (canvas.height - totalHeight) / 2;

            ctx.fillStyle = textColorPicker.value;
            ctx.font = 'bold 120px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('"', canvas.width / 2, y + 60);
            y += 200;

            if (showArabic.checked) {
                ctx.font = 'bold 40px Arial';
                ctx.fillStyle = adjustColor(textColorPicker.value, -30);
                ctx.textAlign = 'center';
                y = wrapText(ctx, hadist.arab, canvas.width / 2, y, maxWidth, 60);
                y += 80;
            }

            ctx.font = '36px Arial';
            ctx.fillStyle = textColorPicker.value;
            ctx.textAlign = 'center';
            y = wrapText(ctx, hadist.id, canvas.width / 2, y, maxWidth, 50);

            y += 100;
            ctx.font = 'bold 120px Arial';
            ctx.fillText('"', canvas.width / 2, y);

            y += 100;
            ctx.font = 'bold 32px Arial';
            ctx.fillStyle = adjustColor(textColorPicker.value, -30);
            ctx.textAlign = 'center';
            ctx.fillText(`${currentAuthor}: ${hadist.number}`, canvas.width / 2, y);
        }

        function wrapText(context, text, x, y, maxWidth, lineHeight) {
            const words = text.split(' ');
            let line = '';

            for (let n = 0; n < words.length; n++) {
                const testLine = line + words[n] + ' ';
                const metrics = context.measureText(testLine);
                const testWidth = metrics.width;
                if (testWidth > maxWidth && n > 0) {
                    context.fillText(line, x, y);
                    line = words[n] + ' ';
                    y += lineHeight;
                } else {
                    line = testLine;
                }
            }
            context.fillText(line, x, y);
            return y + lineHeight;
        }

        function measureTextHeight(context, text, maxWidth, lineHeight) {
            const words = text.split(' ');
            let line = '';
            let height = 0;

            for (let n = 0; n < words.length; n++) {
                const testLine = line + words[n] + ' ';
                const metrics = context.measureText(testLine);
                const testWidth = metrics.width;
                if (testWidth > maxWidth && n > 0) {
                    height += lineHeight;
                    line = words[n] + ' ';
                } else {
                    line = testLine;
                }
            }
            height += lineHeight;
            return height;
        }

        function downloadQuote() {
            const link = document.createElement('a');
            link.download = `${currentAuthor.toLowerCase().replace(' ', '-')}-${currentHadists[currentIndex].number}.png`;
            link.href = canvas.toDataURL();
            link.click();
        }

        function redrawQuote() {
            if (currentHadists.length > 0) {
                drawQuote(currentHadists[currentIndex]);
            }
        }

        function adjustColor(color, amount) {
            return '#' + color.replace(/^#/, '').replace(/../g, color => ('0' + Math.min(255, Math.max(0, parseInt(color, 16) + amount)).toString(16)).substr(-2));
        }
    </script>
</body>
</html>